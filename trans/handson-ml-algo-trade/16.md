# 后续步骤

这本书的目标是让你能够将**机器学习** ( **ML** )应用于各种数据源，并提取对设计和执行投资策略有用的信号。为此，我们引入了 ML 作为交易策略过程中的一个重要元素。我们看到，在设计、测试、执行和评估策略的过程中，ML 可以在多个步骤中增加价值。

很明显，ML 的核心价值主张包括从大量数据中更系统地提取可操作信息的能力，这是人类专家永远无法做到的。一方面，随着数字数据的爆炸，利用计算能力进行数据处理变得更有前途和必要，这一价值主张已经真正流行起来。另一方面，ML 的应用仍然需要大量的人工干预和专业知识来定义目标、选择和管理数据、设计和优化模型以及适当地使用结果。

在这最后一章中，我们将简要总结整本书的关键工具、应用和经验教训，以避免在如此多的细节之后看不到全局。然后，我们将确定我们没有涉及但值得关注的领域，因为您的目标是扩展我们介绍的许多 ML 技术，并在日常使用中变得富有成效。我们将强调对个人生产力有价值的技能组合。

总之，在本章中，我们将讨论以下主题:

*   回顾关键要点和经验教训，
*   指出建立在本书技术基础上的下一步，
*   建议将 ML 融入你的投资过程的方法。

# 关键要点和经验教训

当你开始运用 ML 进行交易时，要记住的重要观点包括:

*   数据是最重要的因素
*   领域专业知识有助于实现数据的潜在价值，尤其是在金融领域
*   ML 为许多用例提供了工具，应该进一步开发和组合这些工具，以使用数据为新问题创建解决方案
*   模型目标和性能诊断的选择是实现最优系统的有效迭代的关键
*   回测过度拟合是一个巨大的挑战，需要特别注意
*   黑盒模型的透明度有助于建立信心和促进采用

我们将对这些想法进行更详细的阐述。

# 数据是最重要的因素

ML 在交易和其他领域的兴起很大程度上补充了我们详细介绍的数据爆炸。我们在[第 2 章](02.html)、*市场和基本面数据*中说明了如何访问和使用这些数据源，这些数据源历来是量化投资的支柱。在[第 3 章](03.html)、*金融的替代数据*中，我们提出了一个框架，其中包含评估替代数据集潜在价值的标准。

一个关键的见解是，像深度神经网络这样的最先进的 ML 技术是成功的，因为它们的预测性能随着更多的数据而不断提高。另一方面，模型和数据的复杂性需要匹配，以平衡偏差-方差的权衡。管理数据质量和集成数据集是实现潜在价值的关键步骤。

# 质量管理

就像石油一样，数据经过一个管道，从原始形式到精炼产品，经过几个阶段，可以为交易策略提供燃料。至关重要的是，要仔细关注最终产品的质量，以从中获得期望的收益。

有时，您获得原始形式的数据，并控制您的目的所需的大量转换。更多的时候，你处理的是一个中间产品，你应该弄清楚数据在这一点上到底测量了什么。

与石油不同，随着数据源的不断增加，通常没有客观的质量标准。相反，质量取决于它的信号内容，而信号内容又取决于你的投资目标。对新数据集进行经济高效的评估需要一个高效的工作流，包括我们将在下一节中讨论的适当基础架构。

# 数据集成

数据对于投资策略的价值通常取决于市场、基本面和替代数据的互补来源的组合。我们看到，像基于树的集成或神经网络这样的 ML 算法的预测能力部分是由于它们检测非线性关系的能力，特别是变量之间的交互作用。

将一个变量的影响作为其他模型特征的函数进行调节的能力依赖于捕获目标结果的不同方面的数据输入。资产价格与宏观基本面、社会情绪、信用卡支付和卫星数据的结合可能会在不同的经济和市场体制中产生比每个来源本身更可靠的预测(前提是数据足够大，足以了解隐藏的关系)。

处理来自多个来源的数据增加了正确标注的挑战。在数据实际可用之前，通过用数据测试算法来分配准确的时间戳以避免前瞻偏差是至关重要的。例如，数据可能具有由提供者分配的时间戳，该时间戳需要调整以反映它们可用于实时算法的时间点。

# 领域专业知识有助于释放数据价值

我们强调数据是成功的 ML 应用的必要驱动力，但是领域专业知识对于通知战略方向、特征工程和数据选择以及模型设计也是至关重要的。

在任何领域，从业者都有关于关键结果的驱动因素和它们之间关系的理论。金融学因大量相关的定量研究而脱颖而出，包括理论研究和实证研究。马科斯·洛佩斯·德·普拉多和其他人(见 GitHub 参考资料[https://GitHub . com/packt publishing/Hands-On-Machine-Learning-for-Trading](https://github.com/PacktPublishing/Hands-On-Machine-Learning-for-Trading))批评了大多数实证结果，因为普遍的数据挖掘可能会使这些结果无效。尽管如此，对金融市场如何运作的充分理解是存在的，并且应该为数据的选择和使用以及依赖于机器学习的策略的合理性提供信息。我们在[第 4 章](04.html)、*阿尔法因子研究*和[第 5 章](05.html)、*战略评估*中概述了关键思想。

另一方面，新的 ML 技术可能会揭示关于财务结果驱动因素的新假设，这些假设将为 ML 理论提供信息，然后应该进行独立测试。

# 特征工程和阿尔法因子研究

比起原始数据，特征工程通常是使信号对算法有用的关键。利用数十年来在理论和经验基础上推动回报的风险因素研究，是对更有可能反映相关信息的数据转换进行优先排序的良好起点。

然而，随着时间的推移，只有创造性的特征工程才会导致能够在市场中竞争的创新策略。即使是对于新的阿尔法因子，考虑到对市场动态和投资者行为的既定观点，一个解释它们如何工作的令人信服的叙述将为资本配置提供更多信心。

错误发现和过度拟合历史数据的风险使得在测试之前确定策略的优先次序变得更加必要，而不是让数据说话。我们讨论了如何根据实验数量缩小夏普比率。

# ML 是一个解决数据问题的工具包

ML 提供了可以应用于许多用例的算法解决方案和技术。本书的第 2、3 和 4 部分(如第 1 章、*中提到的)介绍了 ML 作为一套多样化的工具，可以为策略过程的各个步骤增加价值，包括:*

*   创意产生和阿尔法因子研究，
*   信号聚合和投资组合优化，
*   策略测试
*   交易执行，以及
*   战略评估

更重要的是，最大似然算法被设计为进一步开发、修改和组合，以解决不同环境中的新问题。出于这些原因，理解这些算法背后的关键概念和想法是很重要的，此外还能够将它们应用于生产性实验和研究的数据，如第 6 章、*中概述的机器学习过程*。

此外，最好的结果通常是通过将人类专家与 ML 工具相结合来实现的。在第一章、*的*、 *r 交易的机器学习*中，我们讨论了全权委托交易和算法交易相结合的量化投资风格。这种方法的重要性可能会进一步增加，并且依赖于我们讨论的基本工具的灵活和创造性的应用，以及它们对各种数据集的扩展。

# 模型诊断有助于加速优化

在第六章、[、*的机器学习过程*中，我们概述了一些最重要的概念。ML 算法通过对函数形式进行假设来学习输入数据和目标之间的关系。如果学习是基于噪声而不是信号，预测性能将受到影响。](06.html)

当然，从未来的结果来看，我们今天不知道如何分离信号和噪声。例如，使用学习曲线和优化验证测试的模型诊断可以帮助缓解这一基本挑战，并根据手头的数据或任务校准算法的选择或配置。通过定义集中的模型目标，并且对于复杂的模型，区分由于优化算法或目标本身的问题而导致的性能缺陷，可以使这项任务变得更容易。

# 没有免费午餐也要凑合

除了在训练中观察到的结果之外，没有任何系统——无论是计算机程序还是人类——有可靠的基础来预测新例子的结果。唯一的解决方法是拥有一些额外的先验知识，或者做出超出训练示例的假设。我们涵盖了广泛的算法，从第 7 章、*线性模型*和[第 8 章](08.html)、*时间序列模型*，到第 10 章、*决策树和随机森林*和[第 11 章](11.html)、*梯度推进机器*，以及本书第 4 部分各章节中的神经网络。

我们看到，线性模型强烈假设输入和输出之间的关系具有非常简单的形式，而后面讨论的模型旨在学习更复杂的函数。虽然简单的模型在大多数情况下都会失败，但复杂的模型并不总是更好。如果真实的关系是线性的，但是数据是有噪声的，则复杂模型会将噪声作为它假设存在的复杂关系的一部分来学习。这是“没有免费的午餐定理”背后的基本思想，即没有哪种算法对所有任务都是万能的。在某些情况下，良好的适应是以其他地方的不良表现为代价的。

根据数据定制算法选择的关键工具是基于对模型所做假设的理解的数据探索和实验。

# 管理偏差-方差权衡

对使算法适应数据的挑战的另一种观点是偏差和方差之间的权衡，偏差和方差会导致超出数据自然噪声的预测误差。一个简单的模型，如果不能充分捕捉数据中的关系，就会出现拟合不足和偏差，也就是说，会做出系统性的错误预测。过于复杂的模型会过度拟合并学习除任何信号之外的噪声，因此结果将显示不同样本的大量差异。

在模型选择和优化过程的任何给定迭代中，诊断这种权衡的关键工具是学习曲线。它显示了训练和验证误差如何依赖于样本大小。这使我们能够在不同的选项之间做出决定以提高性能:调整模型的复杂性或获得更多的数据点。

训练误差越接近人类或其他基准，模型越有可能过度拟合。低验证误差告诉我们，我们很幸运，找到了一个好模型。如果验证误差很高，我们就不是。然而，如果它随着训练规模继续下降，更多的数据可能会有所帮助。如果训练误差很高，那么更多的数据不可能有所帮助，我们应该添加功能或使用更灵活的算法。

# 定义有针对性的模型目标

机器学习过程中的第一步是定义算法要优化的目标。有时，选择很简单，例如，在回归问题中。例如，当我们关心精确度和召回率时，分类任务可能更加困难。将相互冲突的目标整合到一个指标中，如 F1 分数，有助于集中优化工作。我们还可以包括需要满足而不是优化的条件。我们还看到，强化学习就是定义正确的奖励函数来指导代理的学习过程。

# 优化验证测试

吴恩达(参见 GitHub 上的参考资料:[https://GitHub . com/packt publishing/Hands-On-Machine-Learning-for-algorithm-Trading](https://github.com/PacktPublishing/Hands-On-Machine-Learning-for-Algorithmic-Trading))强调了由于学习算法或优化算法的问题而导致的性能缺点之间的区别。像神经网络这样的复杂模型假设非线性关系，并且优化算法的搜索过程可能以局部最优而不是全局最优结束。

例如，如果一个模型未能正确翻译一个短语，测试将比较正确预测的得分和搜索算法发现的解决方案。如果学习算法对正确解的评分更高，则搜索算法需要改进。否则，学习算法会针对错误的目标进行优化。

# 当心回测过度拟合

我们在整本书中反复讨论了由于过度拟合历史数据而导致错误发现的风险。[第 5 章](05.html)、*战略评估*阐述了主要驱动因素和潜在补救措施。低信噪比和相对较小的数据集(与网络规模的图像或文本数据相比)使得这一挑战在交易领域尤为严峻。意识是至关重要的，因为获取数据的便利性和应用 ML 的工具会成倍地增加风险。

无处可逃，因为没有预防的方法。然而，我们提出了调整回测指标的方法，以考虑重复试验，如缩小的夏普比率。当制定实时交易策略时，在市场中执行期间，需要进行纸上交易并密切监控表现，这是实施过程的一部分。

# 如何从黑盒模型中获得洞察力

当深度神经网络和复杂集成被认为是难以理解的黑盒模型时，它们可能会引起怀疑，特别是考虑到回测过度拟合的风险。我们介绍了几种方法来深入了解这些模型如何在第十一章、*中做出预测*。

除了传统的特征重要性衡量标准，最近的博弈论创新**SHapley Additive explaining**(**SHAP**)是理解复杂模型机制的重要一步。SHAP 值允许将特征和它们的值精确地归属于预测，因此根据关于给定投资目标的市场行为的特定理论来验证模型的逻辑变得更加容易。除了证明，准确的特征重要性分数和预测的属性允许更深入地洞察感兴趣的投资结果的驱动因素。

另一方面，对于围绕模型预测扩展透明度本身应该是一个目标存在一些争议。深度学习的发明者之一杰弗里·辛顿(Geoffrey Hinton)认为，人类的决定通常也是模糊的，机器也应该根据它们的结果进行评估，正如我们对投资经理的期望一样。

# 实践中交易的 ML

当你开始将众多的工具和技术整合到你的投资和交易过程中时，有许多事情你可以集中精力去做。如果你的目标是做出更好的决策，鉴于你目前的技能，你应该选择既现实又雄心勃勃的项目。这将帮助你开发一个高效的工作流程，并获得实践经验。

我们将简要地列出一些对扩展本书中涉及的 Python 生态系统有用的工具，并参考 GitHub 上列出的链接进行深入研究。其中包括大数据技术，这些技术最终将是大规模实施 ML for trading 策略所必需的。我们还将列出一些允许你使用 Python 实现交易策略的平台，通常可以访问数据源、ML 算法和库。

# 数据管理技术

数据在 ML 流程中的核心作用要求熟悉一系列大规模存储、转换和分析数据的技术，包括使用基于云的服务，如 Amazon Web Services、Azure 和 Google Cloud。

# 数据库系统

数据存储意味着数据库的使用，历史上由关系数据库管理系统主导，这些系统使用 SQL 以定义良好的表格格式存储和检索数据，商业提供商包括 Oracle 和微软，开源实现包括 PostgreSQL 和 MySQL。最近，出现了一些替代品，通常统称为 NoSQL，但种类繁多，即:

*   **键值存储**:对对象的快速读写访问。我们在[第 2 章](02.html)、*市场和基本数据*中讨论了 HDF5 格式，它有助于快速访问熊猫数据帧。
*   **列存储**:利用列中数据的同质性来促进压缩和更快的基于列的操作，例如聚合。在流行的 Amazon Redshift 数据仓库解决方案、Apache Parquet、Cassandra 或 Google 的大表中使用。
*   文档存储(Document store):设计用来存储数据，这些数据不符合 RDBMS 所要求的严格的模式定义。通过我们在[第四章](04.html)、*阿尔法因子研究*中遇到的使用 JSON 或 XML 格式的 web 应用程序普及。例如，在 MongoDB 中使用。
*   **图数据库**:设计用来存储有节点和边的网络，专门查询网络度量和关系。用于 Neo4J 和阿帕奇 Giraph。

已经有了一些向由关系数据库系统建立的惯例的转换。Python 生态系统促进了与许多标准数据源的交互，并提供了快速的 HDF5 和拼花格式，这在整本书中都有演示。

# 大数据技术 Hadoop 和 Spark

大规模的数据管理，即数百 GB 或更大规模的数据管理，需要使用形成集群的多台机器来并行执行读取、写入和计算操作，也就是说，数据分布在不同的机器上。

Hadoop 生态系统已经成为一个开源软件框架，用于使用谷歌开发的 MapReduce 编程模型进行大数据的分布式存储和处理。在 Apache Foundation 的支持下，生态系统已经变得多样化，现在包括了许多项目，涵盖了大规模数据管理的不同方面。Hadoop 中的主要工具包括:

*   **Apache Pig** :使用 MapReduce 实现大规模**提取-转换-加载** ( **ETL** )管道的数据处理语言，由雅虎开发
*   Apache Hive :在脸书开发的针对数 Pb 数据的交互式 SQL 查询的事实标准
*   **阿帕奇 HBASE** : NoSQL 数据库，用于实时读/写访问，可线性扩展至数十亿行和数百万列，并可使用各种不同的模式组合数据源。

Apache Spark 已经成为集群上最流行的交互式分析平台。MapReduce 框架允许并行计算，但需要从磁盘重复读/写操作以确保数据冗余。Spark 大大加快了大规模计算的速度，这是因为**弹性分布式数据** ( **RDD** )结构允许高度优化的内存计算。这包括优化所需的迭代计算，例如许多 ML 算法的梯度下降。

# ML 工具

在本书中，我们讨论了 Python 生态系统的许多库。Python 已经发展成为数据科学和 ML 的首选语言，开源库集继续多样化和成熟，建立在科学计算库 NumPy 和 SciPy 的强大核心之上。广受欢迎的 pandas library 为普及 Python 在数据科学中的应用做出了重大贡献，它正在计划发布 1.0 版本。scikit-learn 接口已经成为现代 ML 库的标准，如`xgboost`或`lightgbm`，它们经常与各种工作流自动化工具接口，如我们在整本书中反复使用的`GridSearchCV`和`Pipeline`。

有几个供应商旨在促进 ML 工作流:

*   H2O . ai([https://www.h2o.ai/](https://www.h2o.ai/))提供了整合云计算和 ML 自动化的 H2O 平台。它允许用户将数以千计的潜在模型与他们的数据相匹配，以探索数据中的模式。它有 Python 以及 R 和 Java 的接口。
*   DataRobot 旨在通过提供一个平台来在云中或内部快速构建和部署预测模型，从而实现模型开发流程的自动化。
*   Dataiku 是一个协作数据科学平台，旨在帮助分析师和工程师探索、原型化、构建和交付他们自己的数据产品

还有几个由公司领导的开源项目，它们构建并扩展了 Python 生态系统:

*   量化对冲基金 Two 适马在`beakerx`项目下为 Jupyter 笔记本环境贡献了量化分析工具
*   彭博已经将 Jupyter 笔记本集成到其终端中，以便于对他们的财务数据进行交互式分析

# 在线交易平台

开发使用机器学习的交易策略的主要选项是在线平台，这些平台经常为成功的交易策略寻找和分配资本。流行的解决方案包括 Quantopian、Quantconnect、QuantRocket，以及最近出现的专注于高频交易的 Alpha Trading Labs。

此外，**Interactive Brokers**(**IB**)提供了一个 Python API，你可以用它来开发自己的交易解决方案。

# 量子乌托邦

我们介绍了 Quantopian 平台，并展示了如何使用它的研究和交易环境来根据历史数据分析和测试交易策略。Quantopian 使用 Python 并提供大量教育材料。

Quantopian 每天都举办竞赛，为其众包对冲基金组合招募算法。Quantopian 为获胜的算法提供资金。实时交易于 2017 年 9 月停止，但该平台仍提供大量历史数据，并吸引了一个活跃的开发者和交易者社区，这是一个讨论想法和向他人学习的良好起点。

# 量子连接

QuantConnect 是另一个开源、社区驱动的算法交易平台，与 Quantopian 竞争。它还提供了一个 IDE 来使用 Python 和其他语言进行回溯测试和实时交易算法策略。

QuantConnect 还拥有来自世界各地的动态全球社区，并提供对众多资产类别的访问，包括股票、期货、外汇和加密货币。它提供了与 IB、OANDA 和 GDAX 等各种经纪商的实时交易集成。

# 量子火箭

QuantRocket 是一个基于 Python 的平台，用于研究、回溯测试和运行自动化的量化交易策略。它提供了数据收集工具、多个数据供应商、一个研究环境、多个回溯测试者，以及通过 IB 进行的实时和书面交易。它以支持国际股票交易而自豪，并以其灵活性而与众不同。

QuantRocket 支持多种引擎——它自己的 Moonshot，以及用户选择的第三方引擎。虽然 QuantRocket 没有传统的 IDE，但它与 Jupyter 集成得很好，可以产生类似的东西。然而，QuantRocket 不是免费的，在撰写本文时，定价从每月 19 美元开始。

# 结论

我们从强调数字数据的爆炸和 ML 作为投资和交易策略的战略能力的出现开始。这种动态反映了金融之外的全球商业和技术趋势，而且更有可能持续下去，而不是停滞或逆转。许多投资公司刚刚开始利用一系列人工智能工具，就像个人正在获得相关技能，业务流程正在适应这些创造价值的新机会一样，如导言章节所述。

也有许多令人兴奋的发展，将 ML 应用到即将到来的交易中，可能会进一步推动当前的势头。它们很可能在未来几年变得相关，包括 ML 过程的自动化、合成训练数据的生成以及量子计算的出现。这个领域非同寻常的活力意味着光是这一点就可以写一本书，而且这个旅程将继续保持激动人心。