# 一、面向交易的机器学习

算法交易依靠计算机程序来执行算法，使交易策略的部分或全部要素自动化。算法是实现目标的一系列步骤或规则，可以采取多种形式。在**机器学习** ( **ML** )的情况下，算法追求学习其他算法的目标，即规则，以实现基于数据的目标，比如最小化预测误差。

这些算法对投资组合经理的各种活动进行编码，投资组合经理观察市场交易并分析相关数据，以决定发出买入或卖出订单。订单序列定义了投资组合的持有量，随着时间的推移，这些投资组合的目的是产生对资本提供者有吸引力的回报，同时考虑到他们的风险偏好。

最终，积极投资管理的目标在于实现阿尔法，即超过评估基准的回报。主动管理的基本法则应用**信息比率** ( **IR** )将主动管理的价值表达为高于基准(通常是指数)回报的投资组合回报与这些回报的波动性的比率。它将信息比率近似为**信息系数** ( **IC** )和策略宽度的乘积，信息系数通过预测与结果的相关性来衡量预测的质量，策略宽度用下注数量的平方根来表示。

因此，产生 alpha 的关键是预测。反过来，成功的预测需要高级信息或处理公共信息的高级能力。算法有助于优化整个投资过程，从资产配置到创意产生、交易执行和风险管理。特别地，将 ML 用于算法交易旨在更有效地使用传统和替代数据，目的是产生更好和更可行的预测，从而提高主动管理的价值。

从历史上看，算法交易过去被更狭隘地定义为交易执行的自动化，以最小化卖方提供的成本，但我们将采取更全面的观点，因为算法的使用，特别是 ML，已经影响到更广泛的活动，从想法产生和阿尔法因子设计到资产分配，头寸规模，以及策略的测试和评估。

本章着眼于更大的图景，ML 的使用如何成为投资行业竞争优势的一个重要来源，以及它在投资过程中的位置，以实现算法交易策略。

我们将在本章中讨论以下主题:

*   这本书是如何组织的，谁应该阅读它
*   ML 是如何在算法交易中扮演策略角色的
*   如何设计和执行交易策略
*   ML 如何增加算法交易策略的价值

# 如何阅读这本书

如果你正在阅读这篇文章，那么你可能已经意识到 ML 已经成为许多行业的一种策略能力，包括投资行业。数字数据的爆炸式增长在很大程度上推动了 ML 的崛起，对投资产生了特别强大的影响，投资已经有了使用复杂模型处理信息的悠久历史。跨资产类别的交易范围意味着，除了曾经是分析工作重点的市场和基本面数据之外，大量新的替代数据可能也是相关的。

您可能还会发现，ML 或数据科学的成功应用需要在个人或团队层面上整合统计知识、计算技能和领域专业知识。换句话说，提出正确的问题、识别和理解可能提供答案的数据、部署广泛的工具以获得结果，并以导致正确决策的方式解释它们是至关重要的。

因此，这本书从一个综合的角度来看待 ML 在投资和交易领域的应用。在这一部分中，我们将列出预期的结果，如何实现目标，以及你需要什么来实现目标并在过程中获得乐趣。

# 期待什么

这本书的目的是让你具备策略眼光、概念理解和实用工具，从应用 ML 到交易和投资过程中增加价值。为此，它将 ML 作为一个过程中的重要元素而不是一个独立的练习。

首先，它涵盖了广泛的监督、非监督和强化学习算法，可用于从与不同资产类别相关的不同数据源中提取信号。它介绍了一个 ML 工作流，并侧重于相关数据和大量代码示例的实际用例。然而，它也发展了数学和统计背景，以促进算法的调整或结果的解释。

这本书认识到，投资者比其他行业更能从第三方数据中提取价值。因此，它不仅涵盖了如何处理市场和基本数据，还涵盖了如何获取、评估、处理和建模非结构化文本和图像数据等替代数据源。

它将使用 ML 来研究和评估 alpha 因子与定量的和基于因子的策略联系起来，并引入项目组合管理作为组合多个 alpha 因子的策略的部署环境。它还强调了 ML 可以增加与单个资产价格相关的预测之外的价值，例如资产配置，并解决了使用 ML 和大型数据集开发交易策略时出现错误发现的风险。

这本书没有提供投资建议或现成的交易算法，这不应该是一个惊喜。相反，提出识别、评估和组合适合任何给定投资目标的数据集所需的构建模块，选择并应用 ML 算法到该数据，并基于结果开发和测试算法交易策略。

# 谁应该读这本书

如果你是一个了解金融市场并对交易策略感兴趣的分析师、数据科学家或 ML 工程师，你会发现这本书内容丰富。作为一名投资专业人士，你也应该发现利用 ML 做出更好决策的价值。

如果你的背景是软件和 ML，你可以略读或跳过一些 ML 的介绍性材料。同样，如果你的专长是投资，你可能会熟悉一些或所有的金融背景。你可能会发现，这本书作为关键算法、构建模块和用例的调查，比专门讨论特定算法或策略更有用。然而，这本书假设你有兴趣继续了解这个非常活跃的领域。为此，它引用了许多资源来支持你的定制交易策略之旅，这些策略利用并建立在它所涵盖的基本方法和工具之上。

你应该能熟练使用 Python 3 和各种科学计算库，如`numpy`、`pandas`或`scipy`，并有兴趣在此过程中学习其他许多库。有一些 ML 和 scikit-learn 的经验会有所帮助，但是我们简要地介绍了基本的工作流程，并参考了各种资源来填补空白或更深入地研究。

# 这本书是如何组织的

这本书全面介绍了 ML 如何为交易策略的设计和执行增加价值。它由四个部分组成，涵盖了数据源和策略开发流程的不同方面，以及应对各种 ML 挑战的不同解决方案。

# 第一部分——框架——从数据到策略设计

第一部分为算法交易策略的发展提供了一个框架。它关注的是本书中讨论的 ML 算法和策略的数据，概述了 ML 如何被用来获得交易信号，以及如何部署和评估策略作为投资组合的一部分。

本章的剩余部分总结了 ML 成为投资中心的方式和原因，描述了交易过程，并概述了 ML 如何增加价值。[第 2 章](02.html)、*市场和基本面数据*，涵盖了原始交易所提供的 tick 和财务报告数据的来源和使用，以及如何访问我们将在本书中依赖的众多开源数据提供商。

[第 3 章](03.html)，*金融替代数据*，提供了评估爆炸式增长的来源和提供商数量的类别和标准。它还演示了如何通过抓取网站来创建替代数据集，例如收集收益电话会议记录，以供本书第二部分中的**自然语言处理** ( **NLP** )和情感分析算法使用。

[第 4 章](04.html)、*阿尔法因子研究*，为理解因子如何工作以及如何衡量它们的表现提供了一个框架，例如使用**信息系数** ( **IC** )。它演示了如何离线和在 Quantopian 平台上使用 Python 库从数据中设计 alpha 因子。它还引入了`zipline`库来回溯测试因子和`alphalens`库来评估它们的预测能力。

[第五章](05.html)、*策略评估*，介绍如何利用历史数据与`zipline`离线和在 Quantopian 平台上建立、测试和评估交易策略。它展示并演示了如何使用`pyfolio`库计算投资组合绩效和风险度量。它还解决了如何管理策略回溯测试的方法挑战，并介绍了从投资组合风险角度优化策略的方法。

# 第 2 部分–ML 基础知识

第二部分介绍了基本的监督和非监督学习算法，并举例说明了它们在交易策略中的应用。它还介绍了 Quantopian 平台，在这个平台上，您可以利用并结合本书中开发的数据和 ML 技术来实现在真实市场中执行交易的算法策略。

[第 6 章](06.html),*机器学习过程*，概述了如何将 ML 模型的预测性能公式化、训练、调整和评估作为一个系统化的工作流程。

[第 7 章](07.html)、*线性模型*，展示了如何使用线性和逻辑回归进行推断和预测，以及如何使用正则化来管理过度拟合的风险。它介绍了 Quantopian 交易平台，并演示了如何建立因素模型和预测资产价格。

[第八章](08.html)，*时间序列模型*，涵盖单变量和多变量时间序列，包括向量自回归模型和协整检验，以及它们如何应用于成对交易策略。[第九章](09.html)、*贝叶斯机器学习*，介绍如何制定概率模型以及**马尔可夫链蒙特卡罗** ( **MCMC** )抽样和变分贝叶斯如何促进近似推理。它还说明了如何使用 PyMC3 进行概率编程，以更深入地了解参数和模型的不确定性。

[第 10 章](10.html)、*决策树和随机森林*，展示了如何构建、训练和调整基于非线性树的模型以进行洞察和预测。它介绍了基于树的集成模型，并展示了随机森林如何使用 bootstrap 聚合来克服决策树的一些弱点。[第十一章](11.html)、*梯度提升机*集成建模并演示如何使用库`xgboost`、`lightgbm`和`catboost`进行高性能训练和预测，并深入回顾如何调整众多超参数。

[第十二章](12.html)、*无监督学习*介绍如何使用降维和聚类进行算法交易。它使用主成分和独立成分分析来提取数据驱动的风险因素。它介绍了几种聚类技术，并演示了资产分配的分层聚类的使用。

# 第 3 部分-自然语言处理

第三部分侧重于文本数据，并介绍了最先进的无监督学习技术，以从这一关键的替代数据来源中提取高质量的信号。

[第十三章](13.html)，*处理文本数据*，演示如何将文本数据转换成数字格式，并将*第二部分*中的分类算法应用于大型数据集的情感分析。[第 14 章](14.html)，*主题建模*，应用贝叶斯无监督学习来提取潜在主题，这些潜在主题可以总结大量文档，并提供更有效的方法来探索文本数据或使用主题作为分类模型的特征。它演示了如何将这种技术应用于来源于第三章、*财务替代数据*的收益电话会议记录，以及向**证券交易委员会** ( **SEC** )提交的年度报告。

[第 15 章](15.html)，*词嵌入*，使用神经网络以单词向量的形式学习最先进的语言特征，这些特征比传统的文本特征更好地捕捉语义上下文，并代表了一种从文本数据中提取交易信号的非常有前途的途径。

# 第 4 部分–深度和强化学习

第 4 部分介绍深度学习和强化学习。

*   [第 17 章](https://www.packtpub.com/sites/default/files/downloads/Deep_Learning.pdf)、*、*深度学习介绍了 Keras、TensorFlow 和 PyTorch 这些最流行的深度学习框架，并举例说明了如何训练和调优各种架构。
*   [第十八章](https://www.packtpub.com/sites/default/files/downloads/Recurrent_Neural_Networks.pdf) [，*递归神经网络，*为时间序列数据呈现 RNNs](https://www.packtpub.com/sites/default/files/downloads/Recurrent_Neural_Networks.pdf) 
*   [第 19 章](https://www.packtpub.com/sites/default/files/downloads/Convolutions_Neural_Networks.pdf)、*卷积神经网络*，说明了如何对图像和文本数据使用 CNN
*   [第 20 章](https://www.packtpub.com/sites/default/files/downloads/Autoencoders_and_Generative_Adversarial_Nets.pdf)、*自动编码器和生成对抗网络*，展示了如何使用深度神经网络通过自动编码器进行无监督学习，并展示了生成合成数据的 GANs
*   [第 21 章](https://www.packtpub.com/sites/default/files/downloads/Reinforcement_Learning.pdf)、*、*演示了使用强化学习来构建动态代理，这些代理使用 OpenAI gym 平台学习基于奖励的策略功能

# 成功需要什么

这本书的内容围绕着最大似然算法在不同数据集上的应用。GitHub 上托管了重要的附加内容，以方便对书中讨论的示例进行回顾和实验。它包含额外的细节和说明以及大量的参考资料。

# 数据源

我们将使用来自市场、基本面和替代来源的免费历史数据。[第 2 章](02.html)、*市场和基本数据*和[第 3 章](03.html)、*金融的替代数据*涵盖了这些数据源的特征和访问，并介绍了我们将在整本书中使用的主要提供商。配套的 GitHub 资源库(见下)包含了如何获取或创建我们将在整个过程中使用的一些数据集的说明，并包括一些较小的数据集。

我们将获取和使用的一些示例数据源包括但不限于:

*   纳斯达克 ITCH 订单数据
*   电子数据收集、分析和检索(EDGAR) SEC 文件
*   Seeking Alpha 的收益电话会议记录
*   3000 多只美国股票的 Quandl 每日价格和其他数据点
*   来自美联储和其他国家的各种宏观基本面数据
*   大型 Yelp 商业评论和 Twitter 数据集
*   油轮上的图像数据

有些数据有几 GB 大(例如纳斯达克和证券交易委员会的文件)。笔记本会指出什么时候是这种情况。

# GitHub 知识库

GitHub 存储库包含 Jupyter 笔记本，这些笔记本更详细地说明了许多概念和模型。本书中使用的地方都提到了笔记本。每章都有自己的目录，在需要的地方有单独的说明，以及针对该章内容的参考。

Jupyter Notebooks 是创建可再现的计算叙事的一个很好的工具，它使用户能够创建和共享将实时代码与叙事文本、数学方程、可视化、交互式控件和其他丰富的输出相结合的文档。它还提供了与数据进行交互计算的构件，如文件浏览器、终端和文本编辑器。

你可以在:
[https://github . com/packt publishing/Hands-On-Machine-Learning-for-Algorithmic-Trading](https://github.com/PacktPublishing/Hands-On-Machine-Learning-for-Algorithmic-Trading)找到代码文件。

# Python 库

这本书使用 Python 3.7，并推荐`miniconda`安装`conda`包管理器，并创建一个`conda`环境来安装必要的库。为此，GitHub repo 包含一个`environment.yml`文件。请参考 GitHub repo 的`README`文件中引用的安装说明。

# ML 在投资行业的崛起

在过去的几十年里，投资行业发生了巨大的变化，并在竞争加剧、技术进步和充满挑战的经济环境中继续发展。这一部分将回顾几个影响投资环境的主要趋势，尤其是算法交易的背景，以及贯穿本书的相关主题。

将算法交易和 ML 推向当前显著地位的趋势包括:

*   市场微观结构的变化，如电子交易的普及和跨资产类别和地域的市场整合
*   根据风险因素敞口而非资产类别制定投资策略
*   计算能力、数据生成和管理以及分析方法的革命
*   算法交易者的先驱相对于人类、自主投资者的优异表现

此外，2001 年和 2008 年的金融危机影响了投资者进行多样化和风险管理的方式，并催生了低成本的被动投资工具，如交易所交易基金(ETF)和 T2 交易所交易基金(ETF)。在 2008 年危机后的低收益率和低波动性中，具有成本意识的投资者将 2 万亿美元从主动管理的共同基金转移到被动管理的 ETF。竞争压力还反映在较低的对冲基金费用上，这些费用从传统的 2%的年管理费和 20%的利润分别降至 2017 年的平均 1.48%和 17.4%。

# 从电子交易到高频交易

自 20 世纪 60 年代网络开始将价格传送到计算机终端以来，电子交易在能力、交易量、资产类别覆盖范围和地理位置方面都取得了巨大的进步。

股票市场引领了全球这一趋势。美国证券交易委员会 1997 年的订单处理规则通过电子通信网络(T2 电子通信网络，T3)将竞争引入了交易所。ECN 是自动化的**替代交易系统** ( **ATS** )，以特定价格匹配买卖订单，主要针对股票和货币，并注册为经纪自营商。它允许不同地理位置的大型经纪公司和个人交易商在交易所和下班后直接交易，无需中介。暗池是另一种类型的 ATS，允许投资者在不公开披露信息的情况下下单和交易，就像在交易所维护的订单簿中一样。自 2007 年 SEC 裁决以来，暗资金池一直在增长，通常位于大型银行内部，并受 SEC 监管。

随着电子交易的兴起，具有成本效益的执行算法得到了快速发展，其应用从卖方迅速扩展到买方，并跨越资产类别。自动化交易在 2000 年左右出现，是一种卖方工具，旨在实现经济高效的交易执行，将订单分散到不同时间，以限制市场影响。这些工具扩展到买方，并通过考虑交易成本和流动性以及短期价格和数量预测等因素变得日益复杂。

**直接市场访问** ( **DMA** )通过允许交易者使用作为交易所成员的经纪人的基础设施和市场参与者身份直接向交易所发送订单，给予交易者对执行的更大控制。保荐接入消除了经纪人的交易前风险控制，形成了**高频交易** ( **HFT** )的基础。

HFT 指的是金融工具的自动化交易，这种交易以微秒级的极低延迟执行，参与者持有头寸的时间非常短。我们的目标是发现和利用市场微观结构中的低效率，即交易场所的机制基础设施。HFT 在过去 10 年里大幅增长，据估计占美国股票市场交易量的 55%左右，占欧洲股票市场交易量的 40%左右。HFT 在期货市场的份额也已增长至约 80%的外汇期货交易量，以及三分之二的利率和 10 年期国债期货交易量(FAS 2016)。

HFT 策略的目的是利用被动或主动的策略在每笔交易中赚取小额利润。被动策略包括套利交易，从在不同场所交易的同一种资产或其衍生品的微小差价中获利。积极的策略包括订单预测或势头点火。订单预测，也称为**流动性检测**，涉及提交小型试探性订单的算法，以检测大型机构投资者的隐藏流动性，并在大订单之前进行交易，以受益于随后的价格波动。动量点火意味着一种算法执行并取消一系列订单，以欺骗其他 HFT 算法更积极地买入(或卖出)，并从由此产生的价格变化中受益。

监管机构对某些激进的 HFT 策略与市场脆弱性和波动性增加之间的潜在联系表示担忧，例如 2010 年 5 月的闪电崩盘、2014 年 10 月的国债市场波动以及 2015 年 8 月 24 日道琼斯工业平均指数突然暴跌 1000 多点。与此同时，由于 HFT 的存在，市场流动性随着交易量的增加而增加，从而降低了整体交易成本。

交易量减少、波动性降低、技术成本上升以及数据和交易场所准入成本上升，这些因素结合在一起，导致了财务压力。据估计，HFT 来自美国股票的总收入自 2008 年以来首次跌破 10 亿美元，低于 2009 年的 79 亿美元。

这一趋势导致了行业整合，例如，最大的上市自营交易公司 Virtu Financial 进行了各种收购，并共享基础设施投资，如芝加哥和东京之间新的 Go West 超低延迟路线。与此同时，阿尔法交易实验室(Alpha Trading Lab)等初创公司通过众包算法提供 HFT 交易基础设施和数据，以实现 HFT 的民主化，并以此换取部分利润。

# 要素投资和智能贝塔基金

资产提供的回报是与金融投资相关的不确定性或风险的函数。例如，股票投资意味着承担公司的商业风险，而债券投资意味着承担违约风险。

就特定风险特征预测回报而言，识别和预测这些风险因素的行为成为设计投资策略时的主要关注点。它产生有价值的交易信号，是卓越的主动管理结果的关键。随着时间的推移，行业对风险因素的理解发生了很大的变化，并影响了 ML 在算法交易中的应用。

**现代投资组合理论** ( **MPT** )介绍了给定资产的特殊风险源和系统风险源之间的区别。特质风险可以通过多样化来消除，但系统性风险却不能。在 20 世纪 60 年代初，**资本资产定价模型** ( **CAPM** )确定了一个驱动所有资产回报的单一因素:市场投资组合的回报超过国债。市场投资组合由所有可交易的证券组成，按市值加权。一项资产在市场上的系统性风险由贝塔系数衡量，贝塔系数是资产回报和市场投资组合之间的相关性。

认识到一项资产的风险并不取决于孤立的资产，而是取决于它如何相对于其他资产和整个市场移动，这是一个重大的概念突破。换句话说，资产不会因为其特定的特质而获得风险溢价，而是因为其暴露于潜在的因素风险。

然而，大量的学术文献和长期的投资经验已经推翻了 CAPM 的预测，即资产风险溢价只取决于他们对由资产的 beta 衡量的单一因素的暴露。相反，许多额外的风险因素已经被发现。一个因素是一个可量化的信号，属性，或任何变量，历史上与未来的股票收益相关，并预计在未来保持相关。

这些风险因素被贴上了异常标签，因为它们与有效市场假说相矛盾，有效市场假说认为市场均衡总是根据资本资产定价模型对证券进行定价，因此没有其他因素具有预测能力。因素背后的经济理论可以是理性的，即因素风险溢价补偿了糟糕时期的低回报，也可以是行为的，即代理人未能套利走超额回报。

众所周知的异常包括价值、规模和动量效应，在控制 CAPM 市场因素的同时有助于预测回报。Banz (1981)和 Reinganum (1981)发现，规模效应取决于小企业系统地胜过大企业。价值效应(Basu 1982)指出，估值指标低的公司表现优异。它表明，市盈率或市净率等价格倍数较低的公司比价格较高的同行表现更好(这是价值投资的发明者本杰明·格拉哈姆和大卫·多德提出的，并由沃伦·巴菲特推广)。

动量效应是由 AQR 的创始合伙人 Clifford Asness 等人在 20 世纪 80 年代末发现的，他指出，就最近 6-12 个月的回报而言，动量好的股票比具有类似市场风险的动量差的股票具有更高的未来回报。研究人员还发现，价值和动量因素解释了美国以外的股票以及其他资产类别(如债券、货币和大宗商品)和其他风险因素的回报。

在固定收益中，价值策略被称为“驾驭收益率曲线”，是久期溢价的一种形式。在商品中，它被称为**滚动回报**，向上倾斜的期货曲线为正回报，否则为负回报。在外汇中，价值策略被称为**进位**。

还有一个非流动性溢价。相对于流动性更强的证券，流动性更差的证券交易价格更低，平均超额收益更高。违约风险较高的债券平均回报率往往较高，反映了信用风险溢价。由于当回报趋于崩溃时，投资者愿意为高波动性购买保险，期权市场中波动性保护的卖家往往会获得高回报。

多因素模型从更广泛、更多样的角度定义风险，而不仅仅是市场投资组合。1976 年，斯蒂芬·罗斯提出了套利定价理论，该理论认为，投资者因无法分散的多个系统性风险源而获得补偿。三个最重要的宏观因素是增长、通胀和波动，此外还有生产率、人口和政治风险。1992 年，Eugene Fama 和 Kenneth French 将股票风险因素的大小和价值与一个市场因素结合到一个模型中，该模型更好地解释了横截面股票回报。他们后来添加了一个模型，其中也包括债券风险因素，以同时解释这两种资产类别的回报。

风险因素的一个特别吸引人的方面是它们的低相关性或负相关性。例如，价值和动量风险因素是负相关的，降低了风险，增加了风险调整后的回报，超出了风险因素所暗示的收益。此外，利用杠杆和多空策略，可以将要素策略结合到市场中性方法中。暴露于正面风险的证券多头头寸与暴露于负面风险的证券空头头寸的组合允许收集动态风险溢价。

结果，解释资本资产定价模型之上和之外回报的因素被纳入投资风格，使投资组合倾向于一个或多个因素，资产开始转移到基于因素的投资组合。2008 年金融危机突显出，当投资者不考虑潜在的要素风险时，资产类别标签可能具有高度误导性，并造成一种虚假的多元化感，因为资产类别一起崩溃了。

在过去的几十年里，量化因素投资已经从基于两三种风格的简单方法发展到多因素智能或奇异的 beta 产品。Smart beta 基金在 2017 年已超过 1 万亿美元的 AUM，证明了结合主动和被动管理的混合投资策略的受欢迎程度。Smart beta 基金采取被动策略，但根据一个或多个因素进行调整，例如更便宜的股票或根据股息派发情况筛选股票，以获得更好的回报。与此同时，传统主动型基金经理收取的高额费用受到越来越多的批评，对他们业绩的审查也在加强。

对风险因素的持续发现和成功预测，无论是单独还是与其他风险因素相结合，都会显著影响整个资产类别的未来资产回报，这是投资行业中 ML 激增的关键驱动因素，也将是本书的一个关键主题。

# 算法先锋在规模上胜过人类

引领算法交易的公司所管理的资产(T1)(**【AUM】**)的过往记录和增长，在激发投资者兴趣以及随后行业复制其成功的努力中发挥了关键作用。系统基金与 HFT 的不同之处在于，在寻求利用套利机会时，交易可能持有更长时间，而不是纯粹的速度优势。

主要或完全依赖算法决策的系统策略最著名的是数学家詹姆斯·西蒙斯(James Simons)提出的，他在 1982 年创立了文艺复兴科技公司(Renaissance Technologies)，并将其发展成为首屈一指的量化公司。自 1982 年以来，其对外封闭的秘密大奖章基金的估计年回报率为 35%。

DE Shaw、Citadel 和 Two 适马是三家最著名的量化对冲基金，它们使用基于算法的系统策略，在 2017 年为投资者赚取的总美元数(扣除费用和自成立以来)方面，首次升至历史前 20 名。

德肖成立于 1988 年，拥有 470 亿美元的 AUM，2018 年名列第三。Citadel 于 1990 年由肯尼斯·格里芬(Kenneth Griffin)创立，管理着 290 亿美元的资产，排名第五。DE Shaw 的校友约翰·奥弗迪克(John Overdeck)和大卫·西格尔(Steve Ballmer)于 2001 年创立的两个适马从 2011 年的 80 亿美元增长到 2018 年的 520 亿美元。Bridgewater 成立于 1975 年，拥有超过 1500 亿美元的 AUM，由于其纯 Alpha 基金也包含系统策略，因此继续领先。

同样，在机构投资者 2017 年对冲基金 100 强榜单上，前六名公司中有五家在很大程度上或完全依赖计算机和交易算法来做出投资决策——所有这些公司都在一个充满挑战的环境中增长资产。一些专注于数量的公司上升了几个级别，在某些情况下，他们的资产增长了两位数。排名第二的**应用量化研究** ( **AQR** )在 2017 年将其对冲基金资产增长 48%，至 697 亿美元，管理着 1876 亿美元的全公司资产。

在所有对冲基金中，按照过去三年的复合业绩排名，Renaissance Technologies 管理的量化基金分别排名第 6 和第 24 位，两个适马排名第 11 位，D.E. Shaw 排名第 18 和第 32 位，Citadel 排名第 30 和第 37 位。除了表现出色的人，算法策略在过去几年里也表现不错。在过去五年中，专注于量化的对冲基金每年增长约 5.1%，而同期对冲基金的平均年增长率为 4.3%。

# ML 驱动基金吸引 1 万亿美元 AUM

人们熟悉的计算能力、数据和 ML 方法的三次革命使得采用系统的、数据驱动的策略不仅更具吸引力和成本效益，而且是竞争优势的关键来源。

因此，算法方法不仅在开创了这些策略的对冲基金行业得到了更广泛的应用，也在更广泛的资产管理公司，甚至是 ETF 等被动管理的工具中得到应用。特别是，使用机器学习和算法自动化的预测分析在跨资产类别的投资流程的所有步骤中发挥着越来越重要的作用，从创意产生和研究到策略制定和投资组合构建、交易执行和风险管理。

对行业规模的估计各不相同，因为没有量化或算法基金的客观定义，许多传统对冲基金甚至共同基金和 ETF 正在引入计算机驱动的策略，或以人机结合的方式将其整合到自主环境中。

摩根士丹利在 2017 年估计，算法策略在过去六年中每年增长 15%，在对冲基金、共同基金和 smart beta ETFs 之间控制着约 1.5 万亿美元。其他报告显示，量化对冲基金行业的规模即将超过 1 万亿美元 AUM，自 2010 年以来，由于传统对冲基金的资金外流，其规模几乎翻了一番。相比之下，根据最新的全球对冲基金研究报告，对冲基金行业资本总额达到 3.21 万亿美元。

市场研究公司 Preqin 估计，近 1500 家对冲基金的大部分交易都是在计算机模型的帮助下完成的。量化对冲基金现在负责投资者所有美国股票交易的 27%，高于 2013 年的 14%。但是许多公司使用数据科学家——或者量化分析师——反过来，他们使用机器来建立大型统计模型。

然而，近年来，基金已经转向真正的 ML，人工智能系统可以快速分析大量数据，并通过这样的分析来改进自己。最近的例子包括 Rebellion Research、Sentient 和 Aidyia，它们依靠进化算法和深度学习来设计全自动**人工智能** ( **AI** )驱动的投资平台。

从核心的对冲基金行业，算法策略的采用已经扩展到共同基金，甚至以智能贝塔基金(smart beta funds)形式的被动管理的交易所交易基金(ETF)，以及以量化方法形式的自由支配基金。

# 量子基金的出现

在主动投资管理中发展出了两种截然不同的方法:系统投资(或量化投资)和自主投资。系统方法依赖于算法的可重复和数据驱动的方法，以确定许多证券的投资机会；相比之下，全权委托方法涉及对少量证券的深入分析。随着基本面管理人员采取更多数据科学驱动的方法，这两种方法变得越来越相似。

根据巴克莱银行的数据，即使是基本面交易者现在也用量化技术武装自己，占据了 550 亿美元的系统资产。量化基金不依赖于具体的公司，它的交易模式和动态跨越了广泛的证券领域。巴克莱(Barclays)汇编的数据显示，量化分析师目前约占对冲基金总资产的 17%。

拥有 120 亿美元资产的 Point72 资产管理公司已经将大约一半的投资组合经理转移到人机结合的方式。Point72 还向一个分析大量替代数据并将结果传递给交易员的小组投资了数千万美元。

# 策略能力投资

对相关能力(技术、数据以及最重要的技术人员)的投资不断增加，突显出利用 ML 进行算法交易对竞争优势的重要性，特别是考虑到 2008 年金融危机以来 ETF 等被动指数化投资工具越来越受欢迎。

摩根士丹利指出，只有 23%的 quant 客户表示他们不考虑使用或尚未使用 ML，低于 2016 年的 44%。

Guggenheim Partners LLC 在加州劳伦斯伯克利国家实验室花费 100 万美元建立了一个所谓的超级计算集群，以帮助 Guggenheim 的 quant 投资基金处理数据。计算机的电费每年要多花 100 万美元。

AQR 是一家量化投资集团，依靠学术研究来识别和系统地交易随着时间的推移已被证明跑赢大盘的因素。该公司过去常常避开像文艺复兴科技公司或德肖这样的定量同行的纯计算机驱动的策略。然而，最近，AQR 开始在市场中寻找盈利模式，使用 ML 解析新的数据集，如油井和油轮阴影的卫星图片。

拥有超过 5 万亿美元 AUM 的领先公司贝莱德(BlackRock)也押注于算法，通过大量投资于它在金融危机期间收购的系统性交易公司 SAE 来击败自主基金经理。富兰克林邓普顿收购了 Random Forest Capital，这是一家专注于债务、以数据为导向的投资公司，金额未披露，希望其技术能够支持更广泛的资产管理公司。

# ML 和替代数据

对冲基金长期以来一直通过信息优势和发现新的不相关信号的能力来寻找阿尔法。从历史上看，这包括对购物者或选举或公投前选民的专有调查。偶尔，利用公司内部人士、医生和专家网络来扩大对行业趋势或公司的了解会越过法律界限:2010 年后一系列针对交易员、投资组合经理和分析师使用内幕信息的起诉震动了整个行业。

相比之下，使用 ML 开发传统和替代数据源的信息优势与专家和行业网络或进入公司管理层无关，而是收集大量数据并实时分析它们的能力。

三个趋势彻底改变了算法交易策略中数据的使用，并可能进一步将投资行业从全权委托风格转变为量化风格:

*   数字数据量的指数增长
*   以更低的成本增加计算能力和数据存储容量
*   复杂数据集分析的最大似然方法进展

传统数据包括经济统计数据、交易数据或公司报告。替代数据要广泛得多，包括卫星图像、信用卡销售、情感分析、移动地理定位数据和网站抓取等来源，以及将日常业务过程中生成的数据转化为有价值的情报。原则上，它包括任何包含可以使用 ML 提取的交易信号的数据源。

例如，来自一家保险公司的新车保单销售数据不仅代表新车销量，还可以细分为品牌或地域。许多供应商从网站上搜集有价值的数据，从应用下载和用户评论到航空公司和酒店预订。也可以在社交媒体网站上寻找消费者观点和趋势的线索。

通常，数据集很大，需要使用可扩展的并行处理数据解决方案(如 Hadoop 和 Spark)进行存储、访问和分析；根据德意志银行的数据，有超过 10 亿个网站拥有超过 10 万亿个个人网页，拥有 500 亿艾字节(或 5000 亿吉字节)的数据。每年有超过 1 亿个网站加入互联网。

在公司业绩发布之前很久，对公司前景的实时洞察可以从公司网站上职位列表的减少、招聘网站 Glassdoor 上员工对其首席执行官的内部评级或公司网站上服装平均价格的下降中收集到。这可以与停车场的卫星图像和手机的地理定位数据结合起来，显示有多少人在逛商店。另一方面，可以从特定职能领域或某些地区的职位空缺中了解策略动向。

最有价值的来源之一是直接揭示消费者支出的数据，其中信用卡信息是主要来源。该数据仅提供了销售趋势的部分视图，但是当与其他数据结合时，可以提供重要的见解。例如，Point72 每天分析 8000 万笔信用卡交易。我们将在[第 3 章](03.html)、*金融替代数据*中探讨各种来源、它们的用例以及如何对它们进行详细评估。

过去两年，投资集团在另类投资组合和数据科学家方面的支出增加了一倍以上，因为资产管理行业试图重振其日渐衰落的命运。2018 年 12 月，有 375 家替代数据提供商在[alternativedata.org](https://alternativedata.org/)上市(由提供商 Yipit 发起)。

根据[alternativedata.org](https://alternativedata.org/)对投资者的调查，资产管理公司去年在数据集和雇佣新员工解析数据集上总共花费了 3.73 亿美元，比 2016 年增加了 60%，今年可能会花费 6.16 亿美元。它预测，到 2020 年，总支出将攀升至 10 亿美元以上。一些估计甚至更高:咨询公司 Optimus 估计，投资者每年在替代数据上的支出约为 50 亿美元，并预计该行业在未来几年将每年增长 30%。

随着对有价值数据源的竞争加剧，排他性安排成为数据源合同的一个关键特征，以保持信息优势。与此同时，对隐私的担忧也在增加，监管机构已经开始关注目前基本上不受监管的数据提供商行业。

# 交易算法的众包

最近，一些算法交易公司已经开始提供投资平台，提供数据访问和编程环境，以众包风险因素，成为投资策略或整个交易算法的一部分。主要例子包括 WorldQuant、Quantopian 和 2018 年推出的 Alpha Trading Labs。

自 2007 年以来，WorldQuant 以 346 亿美元的 AUM 为 Millennium Management 管理着超过 50 亿美元的资金，并于 2018 年宣布将推出其首只公共基金。它在世界各地的阿尔法工厂雇佣了数百名科学家和更多的兼职工人，将投资过程组织成一条定量装配线。这家工厂声称已经生产了 400 万个成功测试的阿尔法因子，用于更复杂的交易策略，目标是生产 1 亿个。每个阿尔法因子都是一种算法，旨在预测未来资产价格的变化。然后，其他团队将阿尔法因素结合到策略中，将策略结合到投资组合中，在投资组合之间分配资金，并管理风险，同时避免相互蚕食的策略。

# 交易策略的设计和执行

ML 可以在交易策略生命周期的多个阶段增加价值，并且依赖于关键的基础设施和数据资源。因此，这本书旨在解决如何 ML 技术适合更广泛的设计，执行和评估策略的过程。

算法交易策略是由阿尔法因子的组合驱动的，这些因子将一个或几个数据源转化为信号，进而预测未来的资产回报并触发买入或卖出订单。[第 2 章](02.html)、*市场和基本数据*和[第 3 章](03.html)、*金融替代数据*涵盖了数据的来源和管理、原材料以及成功交易策略的最重要驱动因素。

[第 4 章](04.html)，*阿尔法因子研究*概述了一个方法合理的流程，用于管理随着数据量增加而增加的错误发现风险。[第 5 章](05.html)、*策略评估*为交易策略的执行和绩效衡量提供了背景:

![](img/582f35e2-19b6-4017-860c-4e9388c5fc86.png)

让我们简单看一下这些步骤，我们将在接下来的章节中深入讨论。

# 采购和管理数据

数据在数量、种类和速度方面的戏剧性演变是将最大似然法应用于算法交易的必要条件和驱动力。数据的激增需要主动管理来发掘潜在价值，包括以下步骤:

1.  识别和评估市场、基本面和替代数据源，这些数据源包含不会过快衰减的 alpha 信号。
2.  部署或访问基于云的可扩展数据基础架构和分析工具，如 Hadoop 或 Spark Sourcing，以促进快速、灵活的数据访问
3.  通过在**时间点** ( **坑**)的基础上将数据调整到所需的频率，仔细管理和策划数据以避免前瞻偏差。这意味着数据可能只反映在给定时间可获得和已知的信息。在扭曲的历史数据上训练的 ML 算法几乎肯定会在现场交易中失败。

# 阿尔法因子研究与评估

阿尔法因子旨在从数据中提取信号，以预测给定投资领域在交易期限内的资产回报。评估时，因子对每项资产采用单个值，但可以组合一个或几个输入变量。该过程包括下图中概述的步骤:

![](img/4cc16e0a-3571-46cd-86b9-56c6dc27f20c.png)

交易策略工作流程的**研究阶段**包括阿尔法因子的设计、评估和组合。ML 在这一过程中扮演着重要的角色，因为随着投资者对简单因素的信号衰减和当今更丰富的数据做出反应，因素的复杂性增加了。

预测阿尔法因子的开发需要探索输入数据和目标回报之间的关系，创造性的特征工程，以及数据转换的测试和微调，以优化输入的预测能力。

数据转换的范围从简单的非参数排序到复杂的集成模型或深度神经网络，取决于输入中的信号数量以及输入和目标之间关系的复杂性。在过去的几十年里，许多更简单的因素已经从学术研究中出现，并在工业中得到越来越广泛的应用。

为了最大限度地降低数据挖掘导致的错误发现的风险，并且因为金融一直是几十年来的研究主题，并导致了几项诺贝尔奖，投资者更喜欢依赖与金融市场和投资者行为理论相一致的因素。阐述这些理论超出了本书的范围，但是参考资料会强调深入算法交易策略这个重要框架的途径。

为了验证候选α因子的信号内容，有必要在代表市场机制的环境中获得其预测能力的稳健估计，在该环境中，该因子将用于策略中。可靠的估计需要避免许多方法和实践上的缺陷，包括使用不反映实际矿坑信息而导致存活或前瞻偏差的数据，或由于对相同数据进行多次测试而未能纠正偏差。

从阿尔法因子导出的信号通常单独较弱，但是当与其他因子或数据源组合时足够强大，例如，将信号调制为市场或经济环境的函数。

# 投资组合优化和风险管理

阿尔法因子发出进场和出场信号，导致买卖订单，订单的执行导致投资组合的持有。各个头寸的风险状况相互作用，形成特定的投资组合风险状况。投资组合管理涉及头寸权重的优化，以实现期望的投资组合风险，并回报与总体投资目标一致的投资组合。这个过程是高度动态的，包含不断发展的市场数据。

在此过程中执行交易需要平衡交易者的困境:快速执行往往会因市场影响而推高成本，而当实现的价格偏离决策时的价格时，缓慢执行可能会造成执行不足。风险管理发生在整个投资组合管理过程中，根据观察到的或预测的影响投资组合风险状况的市场环境变化，调整持股或承担对冲。

# 策略回溯测试

将投资理念纳入算法策略需要用科学方法进行广泛的测试，试图根据其在替代样本外市场情景中的表现来拒绝该理念。测试可能涉及模拟数据，以捕捉被认为可能但未反映在历史数据中的场景。

策略回溯测试引擎需要真实地模拟策略的执行，以实现公正的性能和风险评估。除了数据引入的潜在偏差或统计数据的错误使用之外，回溯测试引擎还需要准确地代表交易信号评估、订单下达和符合市场条件的执行的实际方面。

# ML 和算法交易策略

量化策略在三次浪潮中发展并变得更加复杂:

1.  在 1980 年代和 1990 年代，信号通常来自学术研究，并使用来自市场和基本面数据的单一或非常少的投入。这些信号现在很大程度上已经商品化，可以作为 ETF 使用，比如基本的均值回归策略。
2.  2000 年代，基于要素的投资激增。基金使用算法来识别暴露于价值或动量等风险因素的资产，以寻求套利机会。金融危机早期的赎回引发了 2007 年 8 月的量化宽松地震，波及基于因素的基金行业。这些策略现在也可以作为只做多的 smart-beta 基金，根据一组给定的风险因素倾斜投资组合。
3.  第三个时代由对 ML 能力和替代数据的投资驱动，以产生可重复交易策略的盈利信号。因素衰减是一个主要挑战:由于竞争和拥挤，新异常的超额回报从发现到发表下降了四分之一，发表后下降了 50%以上。

有几类交易策略使用算法来执行交易规则:

*   旨在从小幅价格波动中获利的短期交易，例如套利交易
*   旨在利用对其他市场参与者行为的预测的行为策略
*   旨在优化交易执行的计划，以及
*   基于预测价格的大量交易

上面讨论的 HFT 基金主要依靠短期持有期，从基于买卖套利或统计套利的微小价格波动中获利。行为算法通常在流动性较低的环境中运行，旨在预测大型参与者可能会对价格产生重大影响的举动。对价格影响的预期是基于嗅探算法，这种算法能够洞察其他市场参与者的策略或市场模式，如交易所交易基金的强制交易。

交易执行程序旨在限制交易的市场影响，范围从简单的交易分割到匹配时间加权平均价格(T1)(**【TWAP】**)或交易量加权平均价格(T5)(**【VWAP】**)。简单的算法利用历史模式，而更复杂的算法考虑交易成本、实施短缺或预测的价格变动。这些算法可以在证券或投资组合层面运行，例如，实现多重衍生产品或跨资产交易。

# 交易的 ML 用例

ML 从广泛的市场、基本面和替代数据中提取信号，可以应用于算法交易策略过程的所有步骤。主要应用包括:

*   用于识别模式和提取特征的数据挖掘
*   监督学习产生风险因子或阿尔法值，并创造交易想法
*   将单个信号整合到一个策略中
*   根据通过算法学习的风险概况分配资产
*   测试和评估策略，包括通过使用合成数据
*   使用强化学习对策略进行交互式的自动化改进

我们简要地强调了其中的一些应用，并指出在后面的章节中我们将在哪里演示它们的使用。

# 用于特征提取的数据挖掘

大型复杂数据集的成本效益评估需要大规模的信号检测。整本书有几个例子:

*   信息论是一个有用的工具来提取捕捉潜在信号的特征，并可以在 ML 模型中使用。在[第 4 章](04.html)、*阿尔法因子研究*中，我们使用互信息来评估个别特征的潜在价值，以便监督学习算法预测资产回报。
*   在[第十二章](12.html)、*无监督学习*中，我们介绍了从高维数据集创建特征的各种技术。在[第 14 章](14.html)、*主题建模*中，我们将这些技术应用于文本数据。
*   我们强调模型特定的方法来获得对单个变量的预测能力的洞察力。我们使用一种新的博弈论方法，称为 **SHapley 加法解释** ( **SHAP** )来将预测性能归因于具有大量输入变量的复杂梯度提升机器中的个体特征。

# 用于阿尔法因子创建和聚集的监督学习

将 ML 应用于交易的主要理由是获得对资产基本面、价格变动或市场条件的预测。一个策略可以利用多个互为基础的 ML 算法。下游模型可以通过整合对单个资产前景、资本市场预期和证券间相关性的预测，在投资组合层面生成信号。或者，ML 预测可以通知自由交易，如上面概述的定量方法。最大似然预测还可以针对特定的风险因素，如价值或波动性，或实施技术方法，如趋势跟踪或均值回归:

*   在[第 3 章](03.html)、*金融的替代数据*中，我们展示了如何利用基本面数据为 ML 驱动的估值模型创建输入
*   在 [第 13 章](13.html)、*使用文本数据*、[第 14 章](14.html)、*主题建模*和[第 15 章](15.html)、*词嵌入*中，我们使用商业评论上的替代数据，这些数据可用于预测公司的收入，作为评估活动的输入。
*   在[第 8 章](08.html)、*时间序列模型*中，我们展示了如何预测宏观变量作为市场预期的输入，以及如何预测波动性等风险因素
*   在[第 18 章](https://www.packtpub.com/sites/default/files/downloads/Recurrent_Neural_Networks.pdf)、*递归神经网络*中，我们介绍了**递归神经网络** ( **RNNs** )，它们在处理非线性时间序列数据时表现出色。

# 资产配置

ML 已经被用于基于决策树模型分配投资组合，该模型计算风险平价的分级形式。因此，风险特征是由资产价格模式而非资产类别驱动的，并实现了卓越的风险回报特征。

在[第 5 章](05.html)、*策略评估*和[第 12 章](12.html)、*无监督学习*中，我们说明了分层聚类如何提取数据驱动的风险类别，这些类别比传统的资产类别定义更好地反映了相关性模式。

# 测试贸易理念

回溯测试是选择成功的算法交易策略的关键步骤。使用合成数据的交叉验证是一项关键的 ML 技术，当与适当的方法结合以校正多重测试时，可产生可靠的样本外结果。金融数据的时间序列性质要求对标准方法进行修改，以避免前瞻偏差或污染用于训练、验证和测试的数据。此外，历史数据的有限可用性催生了使用合成数据的替代方法:

*   我们将展示各种方法来测试 ML 模型，使用市场，基本面和替代获得样本外误差的合理估计。
*   在[第 20 章](https://www.packtpub.com/sites/default/files/downloads/Autoencoders_and_Generative_Adversarial_Nets.pdf)、*自动编码器和生成对抗网络*中，我们展示了能够生成高质量合成数据的 GAN。

# 强化学习

交易发生在竞争激烈、互动的市场中。强化学习旨在训练代理学习基于奖励的策略功能。

*   在[第 21 章](https://www.packtpub.com/sites/default/files/downloads/Reinforcement_Learning.pdf)、*强化学习*中，我们展示了关键的强化算法，如 Q-Learning 和 Dyna 架构，并展示了使用 OpenAI 的 gym 环境训练交易的强化算法。

# 摘要

在这一章中，我们介绍了算法交易策略，以及 ML 如何成为阿尔法因子设计和组合的关键因素，而阿尔法因子反过来又是投资组合表现的关键驱动因素。我们讨论了围绕算法交易策略的各种行业趋势，替代数据的出现，以及使用 ML 来开发这些信息优势的新来源。

此外，我们介绍了算法交易策略的设计过程，阿尔法因子的重要类型，以及我们将如何使用 ML 来设计和执行我们的策略。在接下来的两章中，我们将使用 ML 更深入地研究推动任何算法交易策略的石油——市场、基本面和替代数据源。